apiVersion: kyverno.io/v2
kind: PolicyException
metadata:
  name: csi-nfs
spec:
  exceptions:
  - policyName: podsecurity-restricted
    ruleNames:
    - restricted
  match:
    any:
    - resources:
        kinds:
        - Pod
        - DaemonSet
        namespaces:
        - storage
        names:
        - csi-nfs*

  ## TODO: Re-enable once Kyverno issue https://github.com/kyverno/kyverno/issues/15111 is resolved
  # podSecurity:
  #   - controlName: "Capabilities"
  #     images:
  #       - "*/sig-storage/nfsplugin*"
  #   - controlName: "Host Namespaces"
  #   - controlName: "HostPath Volumes"
  #   - controlName: "Privilege Escalation"
  #     images:
  #       - "*/sig-storage/csi-node-driver-registrar*"
  #       - "*/sig-storage/csi-provisioner*"
  #       - "*/sig-storage/csi-resizer*"
  #       - "*/sig-storage/csi-snapshotter*"
  #       - "*/sig-storage/livenessprobe*"
  #       - "*/sig-storage/nfsplugin*"
  #   - controlName: "Privileged Containers"
  #     images:
  #       - "*/sig-storage/nfsplugin*"
  #   - controlName: "Running as Non-root"
  #     images:
  #       - "*/sig-storage/csi-node-driver-registrar*"
  #       - "*/sig-storage/csi-provisioner*"
  #       - "*/sig-storage/csi-resizer*"
  #       - "*/sig-storage/csi-snapshotter*"
  #       - "*/sig-storage/livenessprobe*"
  #       - "*/sig-storage/nfsplugin*"
  #   - controlName: "Volume Types"
