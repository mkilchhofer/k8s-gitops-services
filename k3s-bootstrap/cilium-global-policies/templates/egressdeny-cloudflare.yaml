apiVersion: cilium.io/v2
kind: CiliumClusterwideNetworkPolicy
metadata:
  name: "deny-cloudflared-egress"
  labels:
    {{- include "cilium-global-policies.labels" . | nindent 4 }}
spec:
  endpointSelector:
    matchExpressions:
    - key: io.cilium.k8s.namespace.labels.kubernetes.io/metadata.name
      operator: NotIn
      values:
      - cloudflared

  description: "Only allow one Namespace to access Cloudflare Tunnel endpoints"
  egressDeny:
    # Ref: https://developers.cloudflare.com/cloudflare-one/networks/connectors/cloudflare-tunnel/configure-tunnels/tunnel-with-firewall/
  - toCIDR:
      # region1.v2.argotunnel.com
    - 198.41.192.167/32
    - 198.41.192.67/32
    - 198.41.192.57/32
    - 198.41.192.107/32
    - 198.41.192.27/32
    - 198.41.192.7/32
    - 198.41.192.227/32
    - 198.41.192.47/32
    - 198.41.192.37/32
    - 198.41.192.77/32
      # region2.v2.argotunnel.com
    - 198.41.200.13/32
    - 198.41.200.193/32
    - 198.41.200.33/32
    - 198.41.200.233/32
    - 198.41.200.53/32
    - 198.41.200.63/32
    - 198.41.200.113/32
    - 198.41.200.73/32
    - 198.41.200.43/32
    - 198.41.200.23/32
