apiVersion: kyverno.io/v2
kind: PolicyException
metadata:
  name: istio
spec:
  exceptions:
  - policyName: podsecurity-restricted
    ruleNames:
    - restricted
  match:
    any:
    - resources:
        kinds:
          - Pod
  podSecurity:
    - controlName: Capabilities
      images:
        - "*/istio/proxyv2*"
      restrictedField: spec.initContainers[*].securityContext.capabilities.add
      values:
        - NET_ADMIN
        - NET_RAW
    - controlName: "Running as Non-root"
      images:
        - "*/istio/proxyv2*"
    - controlName: "Running as Non-root user"
      images:
        - "*/istio/proxyv2*"
    - controlName: "Seccomp"
      images:
        - "*/istio/proxyv2*"
