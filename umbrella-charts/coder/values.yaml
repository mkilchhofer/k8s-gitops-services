global:
  postgresql:
    auth:
      existingSecret: "db-secret"
      username: "coder"
      database: "coder"
      secretKeys:
        adminPasswordKey: "adminPassword"
        userPasswordKey: "userPassword"

postgresql:
  primary:
    persistence:
      storageClass: iscsi-manual
      size: 10Gi
    networkPolicy:
      allowExternal: false

coder:
  coder:
    env:
      - name: CODER_CACHE_DIRECTORY
        value: /tmp/coder

      - name: PG_PASSWORD
        valueFrom:
          secretKeyRef:
            name: db-secret
            key: userPassword

      - name: CODER_PG_CONNECTION_URL
        value: postgres://coder:$(PG_PASSWORD)@coder-postgresql.coder.svc.cluster.local:5432/coder?sslmode=disable
    podLabels:
      coder-postgresql-client: "true"
    securityContext:
      capabilities:
        drop:
          - ALL

    volumes:
      - name: "cache"
        emptyDir: {}
    volumeMounts:
      - name: "cache"
        mountPath: "/tmp"
