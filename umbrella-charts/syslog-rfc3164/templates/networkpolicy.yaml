{{- $Values := index .Values "fluent-bit" -}}
{{- $context := dict "Chart" .Chart "Release" .Release "Values" $Values }}
{{- if not $Values.networkPolicy.enabled }}
apiVersion: "networking.k8s.io/v1"
kind: "NetworkPolicy"
metadata:
  name: {{ include "fluent-bit.fullname" $context | quote }}
  namespace: {{ .Release.Namespace }}
  labels:
    {{- include "fluent-bit.labels" $context | nindent 4 }}
spec:
  policyTypes:
    - "Ingress"
  podSelector:
    matchLabels:
      {{- include "fluent-bit.selectorLabels" $context | nindent 6 }}
  ingress:
    - ports:
        - protocol: "TCP"
          port: 5140
{{- end }}
