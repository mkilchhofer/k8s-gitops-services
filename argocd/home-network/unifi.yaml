apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: unifi
  namespace: argocd
spec:
  destination:
    namespace: home-network
    server: https://kubernetes.default.svc
  project: apps-restricted
  syncPolicy: {}
  source:
    chart: unifi
    repoURL: https://k8s-at-home.com/charts/
    targetRevision: "1.5.6"
    helm:
      releaseName: unifi
      version: v3
      values: |-
        ingress:
          enabled: true
          annotations:
            kubernetes.io/ingress.class: contour
            ingress.kubernetes.io/force-ssl-redirect: "true"
            cert-manager.io/cluster-issuer: letsencrypt
          hosts:
            - unifi.tools.kilchhofer.info
          tls:
            - hosts:
              - unifi.tools.kilchhofer.info
              secretName: unifi-cert
        image:
          tag: "v6.4.54"
        livenessProbe:
          enabled: false

        resources:
          limits:
            cpu: 1000m
            memory: 1.25Gi
          requests:
            cpu: 100m
            memory: 640Mi

        persistence:
          enabled: true
          storageClass: nfs-data

        controllerService:
          type: LoadBalancer
          externalTrafficPolicy: Local
          loadBalancerIP: "192.168.93.87"
          annotations:
            metallb.universe.tf/allow-shared-ip: unifi
        guiService:
          type: LoadBalancer
          externalTrafficPolicy: Local
          loadBalancerIP: "192.168.93.87"
          annotations:
            metallb.universe.tf/allow-shared-ip: unifi
            projectcontour.io/upstream-protocol.tls: "8443"
        discoveryService:
          type: LoadBalancer
          externalTrafficPolicy: Local
          loadBalancerIP: "192.168.93.87"
          annotations:
            metallb.universe.tf/allow-shared-ip: unifi
        stunService:
          type: LoadBalancer
          externalTrafficPolicy: Local
          loadBalancerIP: "192.168.93.87"
          annotations:
            metallb.universe.tf/allow-shared-ip: unifi
        speedtestService:
          type: LoadBalancer
          externalTrafficPolicy: Local
          loadBalancerIP: "192.168.93.87"
          annotations:
            metallb.universe.tf/allow-shared-ip: unifi
        syslogService:
          type: LoadBalancer
          externalTrafficPolicy: Local
          loadBalancerIP: "192.168.93.87"
          annotations:
            metallb.universe.tf/allow-shared-ip: unifi
